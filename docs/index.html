<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Pool.html">Pool</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Pool.html#acquire">acquire</a></li><li data-type='method' style='display: none;'><a href="Pool.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="Pool.html#getInfo">getInfo</a></li><li data-type='method' style='display: none;'><a href="Pool.html#getOptions">getOptions</a></li><li data-type='method' style='display: none;'><a href="Pool.html#getSize">getSize</a></li><li data-type='method' style='display: none;'><a href="Pool.html#getState">getState</a></li><li data-type='method' style='display: none;'><a href="Pool.html#has">has</a></li><li data-type='method' style='display: none;'><a href="Pool.html#isBorrowed">isBorrowed</a></li><li data-type='method' style='display: none;'><a href="Pool.html#release">release</a></li><li data-type='method' style='display: none;'><a href="Pool.html#releaseAndDestroy">releaseAndDestroy</a></li><li data-type='method' style='display: none;'><a href="Pool.html#start">start</a></li><li data-type='method' style='display: none;'><a href="Pool.html#stop">stop</a></li><li data-type='method' style='display: none;'><a href="Pool.html#use">use</a></li></ul></li><li><a href="PooledObject.html">PooledObject</a><ul class='methods'><li data-type='method' style='display: none;'><a href="PooledObject.html#getIdleTime">getIdleTime</a></li><li data-type='method' style='display: none;'><a href="PooledObject.html#getLoanPromise">getLoanPromise</a></li><li data-type='method' style='display: none;'><a href="PooledObject.html#getObject">getObject</a></li><li data-type='method' style='display: none;'><a href="PooledObject.html#getState">getState</a></li><li data-type='method' style='display: none;'><a href="PooledObject.html#setToAvailable">setToAvailable</a></li><li data-type='method' style='display: none;'><a href="PooledObject.html#setToBorrowed">setToBorrowed</a></li><li data-type='method' style='display: none;'><a href="PooledObject.html#setToDestroyed">setToDestroyed</a></li><li data-type='method' style='display: none;'><a href="PooledObject.html#setToInvalid">setToInvalid</a></li><li data-type='method' style='display: none;'><a href="PooledObject.html#setToReturned">setToReturned</a></li><li data-type='method' style='display: none;'><a href="PooledObject.html#setToValidating">setToValidating</a></li></ul></li><li><a href="PoolRequest.html">PoolRequest</a><ul class='methods'><li data-type='method' style='display: none;'><a href="PoolRequest.html#didTimeout">didTimeout</a></li><li data-type='method' style='display: none;'><a href="PoolRequest.html#getPromise">getPromise</a></li><li data-type='method' style='display: none;'><a href="PoolRequest.html#hasTimeout">hasTimeout</a></li><li data-type='method' style='display: none;'><a href="PoolRequest.html#reject">reject</a></li><li data-type='method' style='display: none;'><a href="PoolRequest.html#resolve">resolve</a></li></ul></li><li><a href="TimeoutError.html">TimeoutError</a></li></ul><h3>Interfaces</h3><ul><li><a href="Factory.html">Factory</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Factory.html#create">create</a></li><li data-type='method' style='display: none;'><a href="Factory.html#destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="Factory.html#validate">validate</a></li></ul></li><li><a href="ObjectQueue.html">ObjectQueue</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ObjectQueue.html#peek">peek</a></li><li data-type='method' style='display: none;'><a href="ObjectQueue.html#pop">pop</a></li><li data-type='method' style='display: none;'><a href="ObjectQueue.html#push">push</a></li><li data-type='method' style='display: none;'><a href="ObjectQueue.html#shift">shift</a></li></ul></li><li><a href="Options.html">Options</a></li><li><a href="RequestQueue.html">RequestQueue</a><ul class='methods'><li data-type='method' style='display: none;'><a href="RequestQueue.html#dequeue">dequeue</a></li><li data-type='method' style='display: none;'><a href="RequestQueue.html#enqueue">enqueue</a></li><li data-type='method' style='display: none;'><a href="RequestQueue.html#remove">remove</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="Pool.html#event:factoryCreateError">factoryCreateError</a></li><li><a href="Pool.html#event:factoryDestroyError">factoryDestroyError</a></li><li><a href="Pool.html#event:factoryValidateError">factoryValidateError</a></li><li><a href="Pool.html#event:poolDidStart">poolDidStart</a></li><li><a href="Pool.html#event:poolDidStop">poolDidStop</a></li></ul>
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3> </h3>		
    </section>









    



    <section class="readme usertext">
        <article><h1>Thingy Pool</h1>
<h2>About</h2>
<p>A promise-based object pool for <a href="https://nodejs.org/">Node.js</a>.</p>
<h2>Installation</h2>
<pre class="prettyprint source lang-sh"><code>$ npm install thingy-pool
</code></pre>
<h2>Creating a factory</h2>
<p>The factory is responsible for creating and destroying the objects being pooled. The factory can also validate the objects if needed. See <a href="#Factory">Factory</a> for more information</p>
<pre class="prettyprint source lang-js"><code>const Api = require('some-api');

const factory = {
  create: async () => {
    const api = new Api();
    await api.connect();
    return api;
  },
  destroy: async api => {
    await api.disconnect();
    console.log(`${api} has been disconnected!`);
  },
};
</code></pre>
<h2>Creating a pool</h2>
<p>See <a href="#Options">Options</a> for a complete list of options</p>
<pre class="prettyprint source lang-js"><code>const Pool = require('thingy-pool');
const factory = require('./myObjectFactory');

const options = { minSize: 2, maxSize: 5 };
const pool = new Pool(factory, options);
</code></pre>
<h2>Using the pool</h2>
<pre class="prettyprint source lang-js"><code>// or const fetchSomething = async () => {
async function fetchAndPrint(something) {
  const thingy = await pool.acquire();
  const result = await thingy.fetch(something);
  pool.release(thingy);
  console.log(`fetched ${something}: ${result}`);
}

fetchAndPrint('something'); // fetched something: result
fetchAndPrint('somethingElse'); // fetched somethingElse: result
</code></pre>
<p>Objects must be released back to the pool after they are used. Alternatively, a callback function can be given to <code>pool.use</code> and the pool will take care of acquiring and releasing the object. See below:</p>
<pre class="prettyprint source lang-js"><code>async function fetchAndPrint(something) {
  const result = await pool.use(thingy => thingy.fetch(something));
  console.log(`fetched ${something}: ${result}`);
}

fetchAndPrint('something'); // fetched something: result
fetchAndPrint('somethingElse'); // fetched somethingElse: result
</code></pre>
<h2>Options</h2>
<table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>minSize</td>
<td><code>number</code></td>
<td>The minimum number of objects the pool will try to maintain including borrowed objects</td>
</tr>
<tr>
<td>maxSize</td>
<td><code>number</code></td>
<td>The maximum number of objects the pool can manage including objects being created</td>
</tr>
<tr>
<td>defaultTimeoutInMs</td>
<td><code>number</code> or <code>null</code></td>
<td>The default time in milliseconds requests for objects will time out</td>
</tr>
<tr>
<td>maxPendingRequests</td>
<td><code>number</code> or <code>null</code></td>
<td>The number of requests that can be queued if the pool is at the maximum size and has no objects available</td>
</tr>
<tr>
<td>checkIdleIntervalInMs</td>
<td><code>number</code> or <code>null</code></td>
<td>The interval the pool checks for and removes idle objects</td>
</tr>
<tr>
<td>maxIdleToRemove</td>
<td><code>number</code> or <code>null</code></td>
<td>The max objects that can be removed each time the pool checks for idle objects</td>
</tr>
<tr>
<td>softIdleTimeInMs</td>
<td><code>number</code> or <code>null</code></td>
<td>The amount of time an object must be idle before being eligible for soft removal</td>
</tr>
<tr>
<td>hardIdleTimeInMs</td>
<td><code>number</code> or <code>null</code></td>
<td>The amount of time an object must be idle before being eligible for hard removal</td>
</tr>
<tr>
<td>shouldAutoStart</td>
<td><code>boolean</code></td>
<td>Should the pool start creating objects to reach the minimum size as soon as it is created?</td>
</tr>
<tr>
<td>shouldValidateOnDispatch</td>
<td><code>boolean</code></td>
<td>Should the pool check objects with factory.validate before dispatching them to requests?</td>
</tr>
<tr>
<td>shouldValidateOnReturn</td>
<td><code>boolean</code></td>
<td>Should the pool check objects with factory.validate when they are being returned?</td>
</tr>
<tr>
<td>shouldUseFifo</td>
<td><code>boolean</code></td>
<td>Should the pool dispatch objects using first in first out (FIFO)?</td>
</tr>
</tbody>
</table>
<h2>Pool Methods</h2>
<h3>pool.acquire(options?) → {Promise&lt;T&gt;}</h3>
<p>Request an object from the Pool. If no objects are available and the pool is below the maximum size, a new one will be created</p>
<h4>options = { priority?, timeoutInMs? }</h4>
<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>priority</td>
<td><code>number</code></td>
<td>The priority for the request. The higher the number the higher the priority</td>
</tr>
<tr>
<td>timeoutInMs</td>
<td><code>number</code> or <code>null</code></td>
<td>Time in milliseconds before the request times out</td>
</tr>
</tbody>
</table>
<pre class="prettyprint source lang-js"><code>const thingy = await pool.acquire();

// With custom priority
const thingy = await pool.acquire({ priority: 5 });

// With custom timeout
const thingy = await pool.acquire({ timeoutInMs: 5000 });

// With custom priority and timeout
const thingy = await pool.acquire({ priority: 10, timeoutInMs: 1000 });
</code></pre>
<h3>pool.clear() → {Promise&lt;void&gt;}</h3>
<p>Destroys all pooled objects that are currently available. Resolves after objects have been destroyed</p>
<pre class="prettyprint source lang-js"><code>pool.getInfo(); // { size: 5, available: 2, borrowed: 3, ...moreInfo }
await pool.clear();
pool.getInfo(); // { size: 3, available: 0, borrowed: 3, ...moreInfo }
</code></pre>
<h3>pool.getInfo() → {<a href="#Pool-Info">PoolInfo</a>}</h3>
<p>Current object counts and pool's state</p>
<pre class="prettyprint source lang-js"><code>pool.getInfo().available; // 2
// or
const { available, borrowed, size, state } = pool.getInfo();
</code></pre>
<h3>pool.getOptions() → {<a href="#Options">Options</a>}</h3>
<p>Current pool options</p>
<pre class="prettyprint source lang-js"><code>pool.getOptions().defaultTimeoutInMs; // 30000
// or
const { maxSize, maxPendingRequests } = pool.getOptions();
</code></pre>
<h3>pool.getSize() → {number}</h3>
<p>Total number of objects in the pool. Includes objects being created and excludes objects being destroyed</p>
<pre class="prettyprint source lang-js"><code>pool.getSize(); // 3
</code></pre>
<h3>pool.has(object) → {boolean}</h3>
<p>Checks if the object is part of the pool</p>
<pre class="prettyprint source lang-js"><code>pool.has(thingy); // true
</code></pre>
<h3>pool.isBorrowed(object) → {boolean}</h3>
<p>Checks if the object is currently borrowed</p>
<pre class="prettyprint source lang-js"><code>pool.isBorrowed(thingy); // true
</code></pre>
<h3>pool.getState() → {PoolState}</h3>
<p>Current pool state as a string</p>
<pre class="prettyprint source lang-js"><code>pool.getState(); // 'STARTED'
</code></pre>
<h3>pool.release(object) → {Promise&lt;void&gt;}</h3>
<p>Returns the object back to the pool for future use</p>
<pre class="prettyprint source lang-js"><code>const thingy = await pool.acquire();
pool.getInfo(); // { size: 5, available: 2, borrowed: 3, ...moreInfo }
const result = await thingy.doSomethingAsync();
await pool.release(thingy);
pool.getInfo(); // { size: 5, available: 3, borrowed: 2, ...moreInfo }
</code></pre>
<h3>pool.releaseAndDestroy(object) → {Promise&lt;void&gt;}</h3>
<p>Returns the object to the pool and destroys it</p>
<pre class="prettyprint source lang-js"><code>const thingy = await pool.acquire();
pool.getInfo(); // { size: 5, available: 2, borrowed: 3, ...moreInfo }
const result = await thingy.doSomethingAsync();
await pool.releaseAndDestroy(thingy);
pool.getInfo(); // { size: 4, available: 2, borrowed: 2, ...moreInfo }
</code></pre>
<h3>pool.start() → {Promise&lt;void&gt;}</h3>
<p>Starts the pool</p>
<pre class="prettyprint source lang-js"><code>await pool.start();
const thingy = await pool.acquire();
</code></pre>
<h3>pool.stop() → {Promise&lt;void&gt;}</h3>
<p>Stops the pool</p>
<pre class="prettyprint source lang-js"><code>const thingy = await pool.acquire();
const finalResult = await thingy.doSomethingAsync();
pool.release(thingy);
pool.stop();
</code></pre>
<h3>pool.use(callback, options?) → {Promise&lt;any&gt;}</h3>
<p>Use a pooled object with a callback and release to object automatically</p>
<h4>options = { priority?, timeoutInMs? }</h4>
<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>priority</td>
<td><code>number</code></td>
<td>The priority for the request. The higher the number the higher the priority</td>
</tr>
<tr>
<td>timeoutInMs</td>
<td><code>number</code> or <code>null</code></td>
<td>Time in milliseconds before the request times out</td>
</tr>
</tbody>
</table>
<pre class="prettyprint source lang-js"><code>const result = await pool.use(thingy => thingy.doSomethingAsync());
</code></pre>
<h2>Pool Info</h2>
<pre class="prettyprint source lang-js"><code>pool.getInfo();
</code></pre>
<table>
<thead>
<tr>
<th>property</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>available</td>
<td><code>number</code></td>
<td>Number of objects that a available for requests</td>
</tr>
<tr>
<td>beingCreated</td>
<td><code>number</code></td>
<td>Number of objects being created</td>
</tr>
<tr>
<td>beingDestroyed</td>
<td><code>number</code></td>
<td>Number of objects being destroyed. Not included in the total pool size</td>
</tr>
<tr>
<td>beingValidated</td>
<td><code>number</code></td>
<td>Number of objects being validated. The sum of beingValidatedForDispatch and beingValidatedForReturn</td>
</tr>
<tr>
<td>beingValidatedForDispatch</td>
<td><code>number</code></td>
<td>Number of objects being validated before attempting to dispatch to a request</td>
</tr>
<tr>
<td>beingValidatedForReturn</td>
<td><code>number</code></td>
<td>Number of objects being validated before being returned to available objects</td>
</tr>
<tr>
<td>pendingRequests</td>
<td><code>number</code></td>
<td>Number of requests waiting for an object</td>
</tr>
<tr>
<td>borrowed</td>
<td><code>number</code></td>
<td>Number of objects currently borrowed</td>
</tr>
<tr>
<td>notBorrowed</td>
<td><code>number</code></td>
<td>Number of objects not currently borrowed</td>
</tr>
<tr>
<td>size</td>
<td><code>number</code></td>
<td>Total number of objects in the pool. Includes objects being created and excludes objects being destroyed</td>
</tr>
<tr>
<td>state</td>
<td><code>string</code></td>
<td>The current pool state</td>
</tr>
</tbody>
</table>
<h2>Pool Events</h2>
<h2>Factory</h2>
<h2>Idle Objects</h2>
<h2>Custom Queue Implementations</h2>
<h2>Testing</h2>
<h2>Benchmarks</h2>
<h2>Credits</h2>
<p>Thingy Pool was heavily inspired by <a href="https://www.npmjs.com/package/generic-pool">Generic Pool</a>. Thanks to <a href="https://github.com/coopernurse">@coopernurse</a> and everyone that has contributed to the project.</p>
<p>Thanks <a href="https://github.com/vitomilana">@vitomilana</a> for your continued interest in the project and helping the team stay on track.</p>
<p>This project was a way for me to learn more about programing. I really appreciate everyone out there asking and answering questions that end up helping people they will never meet.</p>
<p>Special Thanks:</p>
<ul>
<li><a href="https://www.sandimetz.com/">Sandi Metz</a></li>
<li><a href="https://www.traversymedia.com/">Brad Traversy</a></li>
<li><a href="https://github.com/discordjs/discord.js">Discord.js</a></li>
<li><a href="https://github.com/airbnb/javascript">Airbnb JavaScript Style Guide</a></li>
<li><a href="https://github.com/trekhleb/javascript-algorithms">JavaScript Algorithms and Data Structures</a></li>
</ul>
<p>The above people and repositories really helped me while working on this. I'm including them here to say thanks and maybe someone else will find them useful.</p>
<h2>License</h2>
<p>Copyright 2020 <a href="https://github.com/iampatbrown">Pat Brown</a></p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Fri Apr 17 2020 18:25:08 GMT+1000 (Australian Eastern Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>